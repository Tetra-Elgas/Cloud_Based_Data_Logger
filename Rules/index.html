
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Rules - Cloud-Based Data Logger Tutorial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cloud-Based Data Logger Tutorial" class="md-header__button md-logo" aria-label="Cloud-Based Data Logger Tutorial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cloud-Based Data Logger Tutorial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rules
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../Sensor_Module/" class="md-tabs__link">
      Sensor Module
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../Cloud_platform/" class="md-tabs__link">
      Cloud platform
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../Software/" class="md-tabs__link">
      Data Logger Software
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../Retrieve_data/" class="md-tabs__link">
      Retrieve data
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Rules
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../license/" class="md-tabs__link">
      License
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cloud-Based Data Logger Tutorial" class="md-nav__button md-logo" aria-label="Cloud-Based Data Logger Tutorial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Cloud-Based Data Logger Tutorial
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Sensor_Module/" class="md-nav__link">
        Sensor Module
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Cloud_platform/" class="md-nav__link">
        Cloud platform
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Software/" class="md-nav__link">
        Data Logger Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Retrieve_data/" class="md-nav__link">
        Retrieve data
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Rules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Rules
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-case" class="md-nav__link">
    Use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-setup" class="md-nav__link">
    Cloud Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-case" class="md-nav__link">
    Use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-setup" class="md-nav__link">
    Cloud Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="rules">Rules</h1>
<p>AllThingsTalk Platform comes with an integrated rules engine. A rules engine lets you automate work by defining actions that need to be taken in response to a set of triggers. For example, you could make it turn the lights on when you open the door, dispense cat food at predefined times, or notify you if your package is handled improperly in transport.</p>
<h2 id="use-case">Use case</h2>
<p><img alt="CO2 chart" src="\img\CO2 chart.png" /></p>
<p><a href="https://www.buildera.com/carbon-dioxide-co2-monitoring-service">Reference</a></p>
<blockquote>
<p><em>The CO2 content of the air should, ideally, not exceed </em><em>900 ppm</em><em> and under no circumstances should it exceed the standard of </em><em>1200 ppm</em><em>.</em></p>
<p><a href="https://www.info-coronavirus.be/en/ventilation/">reference</a></p>
</blockquote>
<p>The following rules are set:</p>
<p><img alt="rules" src="\img\Rules\rules.PNG" /></p>
<p>References: </p>
<ul>
<li><a href="https://www.allthingstalk.com/faq/get-started-with-rules">get started with rules</a> </li>
<li><a href="https://www.allthingstalk.com/faq/create-custom-rules-using-earl">create rules to your needs</a> </li>
<li><a href="https://www.allthingstalk.com/faq/create-custom-rules-using-earl">create custom rules in EARL</a></li>
</ul>
<h2 id="cloud-setup">Cloud Setup</h2>
<p><strong>Create Virtual asset</strong></p>
<p>First, create a virtual asset.</p>
<p><img alt="AllThingsTalk_New_asset" src="\img\Rules\AllThingsTalk_New_asset.PNG" /></p>
<p><img alt="AllThingsTalk_Create_Asset" src="\img\Rules\AllThingsTalk_Create_Asset.PNG" /></p>
<p><img alt="AllThingsTalk_Assets" src="\img\Rules\AllThingsTalk_Assets.PNG" /></p>
<p><br></p>
<p><strong>Rules setup</strong></p>
<p>Click on Rules &rightarrow;  New Rule</p>
<p><img alt="AllThingsTalk_Rules" src="\img\Rules\AllThingsTalk_Rules.PNG" /></p>
<p>Rule definition:</p>
<p><img alt="AllThingsTalk_Rules_Def" src="\img\Rules\AllThingsTalk_Rules_1.PNG" /></p>
<p><img alt="AllThingsTalk_Rules_Def" src="\img\Rules\AllThingsTalk_Rules_2.PNG" /></p>
<p><img alt="AllThingsTalk_Rules_Def" src="\img\Rules\AllThingsTalk_Rules_3.PNG" /></p>
<p><img alt="AllThingsTalk_Rules_Def" src="\img\Rules\AllThingsTalk_Rules_3.PNG" /></p>
<p><img alt="AllThingsTalk_Rules_Def" src="\img\Rules\AllThingsTalk_Rules_4.PNG" /></p>
<p>On the Pinboard define a label: click on New Pin &rightarrow;  Label</p>
<p><img alt="AllThingsTalk_New_Pin" src="\img\Rules\AllThingsTalk_New_Pin.PNG" /></p>
<p>Choose an asset = CO2_indicator</p>
<p><img alt="AllThingsTalk_New_Pin_Asset" src="\img\Rules\AllThingsTalk_New_Pin_Asset.PNG" /></p>
<p><img alt="AllThingsTalk_Pinboard" src="\img\Rules\AllThingsTalk_Pinboard.PNG" /></p>
<h2 id="test">Test</h2>
<p>Below a Python test script to test the rule definition.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">decoder</span><span class="p">(</span><span class="n">num_values</span><span class="p">):</span>
    <span class="n">value_cat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">num_label</span> <span class="ow">in</span> <span class="n">num_values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num_label</span> <span class="o">&gt;=</span> <span class="mi">1200</span><span class="p">:</span>
            <span class="n">value_cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Bad&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_label</span> <span class="o">&gt;=</span> <span class="mi">900</span><span class="p">:</span>
            <span class="n">value_cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Moderate&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Good&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value_cat</span>


<span class="k">def</span> <span class="nf">send_asset_data_to_cloud</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">payload_timestamp</span><span class="p">,</span> <span class="n">payload_value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send a value to an asset</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    device: type dict</span>
<span class="sd">        device description (defined in a json file)</span>
<span class="sd">    asset_name: str</span>
<span class="sd">        name of the assets</span>
<span class="sd">    payload_timestamp: str</span>
<span class="sd">        timestamp</span>
<span class="sd">    payload_value:</span>
<span class="sd">        payload value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    message: str</span>
<span class="sd">        ConnectionOK: data is send successful</span>
<span class="sd">        ConnectionError: a Connection error occurred. (https://docs.python-requests.org/en/master/_modules/requests/exceptions/)</span>
<span class="sd">        HTTPError: an HTTP error occurred (https://docs.python-requests.org/en/master/_modules/requests/exceptions/)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">][</span><span class="s2">&quot;authentication&quot;</span><span class="p">][</span><span class="s2">&quot;Ground_Token&quot;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># https://api.allthingstalk.io/swagger/ui/index</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span><span class="o">+</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">][</span><span class="s2">&quot;authentication&quot;</span><span class="p">][</span><span class="s2">&quot;api&quot;</span><span class="p">]</span><span class="o">+</span>\
    <span class="s2">&quot;/device/&quot;</span><span class="o">+</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">][</span><span class="s2">&quot;authentication&quot;</span><span class="p">][</span><span class="s2">&quot;Device_ID&quot;</span><span class="p">]</span><span class="o">+</span>\
    <span class="s2">&quot;/state&quot;</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">asset_name</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">payload_value</span><span class="p">,</span>
            <span class="s2">&quot;at&quot;</span><span class="p">:</span> <span class="n">payload_timestamp</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;ConnectionOK&#39;</span>
        <span class="k">return</span> <span class="n">message</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;ConnectionError&#39;</span>
        <span class="k">return</span> <span class="n">message</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;HTTPError&#39;</span>
        <span class="k">return</span> <span class="n">message</span>


<span class="k">def</span> <span class="nf">get_asset_data_from_cloud</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">payload_timestamp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain asset data from the Cloud</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    device: type dict</span>
<span class="sd">        device description (defined in a json file)</span>
<span class="sd">    asset_name: str</span>
<span class="sd">        name of the assets</span>
<span class="sd">    payload_timestamp: str</span>
<span class="sd">        timestamp</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    message: str or float</span>
<span class="sd">        data: the asset data </span>
<span class="sd">        ConnectionError: a Connection error occurred. (https://docs.python-requests.org/en/master/_modules/requests/exceptions/)</span>
<span class="sd">        HTTPError: an HTTP error occurred (https://docs.python-requests.org/en/master/_modules/requests/exceptions/)</span>

<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="c1"># https://api.allthingstalk.io/swagger/ui/index</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://&quot;</span><span class="o">+</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">][</span><span class="s2">&quot;authentication&quot;</span><span class="p">][</span><span class="s2">&quot;api&quot;</span><span class="p">]</span>\
    <span class="o">+</span><span class="s2">&quot;/device/&quot;</span><span class="o">+</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">][</span><span class="s2">&quot;authentication&quot;</span><span class="p">][</span><span class="s2">&quot;Device_ID&quot;</span><span class="p">]</span>\
    <span class="o">+</span><span class="s2">&quot;/asset/&quot;</span><span class="o">+</span><span class="n">asset_name</span><span class="o">+</span><span class="s2">&quot;/states?from=&quot;</span><span class="o">+</span><span class="n">payload_timestamp</span><span class="o">+</span><span class="s2">&quot;&amp;page0&quot;</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">][</span><span class="s2">&quot;authentication&quot;</span><span class="p">][</span><span class="s2">&quot;Ground_Token&quot;</span><span class="p">],</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">payload</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;ConnectionError&#39;</span>
        <span class="k">return</span> <span class="n">message</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;HTTPError&#39;</span>
        <span class="k">return</span> <span class="n">message</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;device.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

<span class="n">asset_name</span> <span class="o">=</span> <span class="s1">&#39;CO2_ppm&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Asset:&#39;</span><span class="p">,</span><span class="n">asset_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>

<span class="n">start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="c1"># Create a random list of payload values (risk values) between 1 and 10 (10 inclusive)</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>

<span class="n">payload</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">data_from_cloud</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">label_from_cloud</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">value_from_cloud</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">payload</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1250</span><span class="p">,</span><span class="mi">950</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">950</span><span class="p">,</span><span class="mi">1250</span><span class="p">,</span><span class="mi">950</span><span class="p">,</span><span class="mi">400</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Payload:&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Payload label:&#39;</span><span class="p">,</span> <span class="n">decoder</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>

<span class="c1"># send &amp; retrieve risk data</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
    <span class="n">payload_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">timestamp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">payload_timestamp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time:&#39;</span><span class="p">,</span> <span class="n">payload_timestamp</span><span class="p">,</span> <span class="s1">&#39;- Value:&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;,- Label:&#39;</span><span class="p">,</span> <span class="n">decoder</span><span class="p">([</span><span class="n">value</span><span class="p">]))</span>

    <span class="c1"># Send data</span>
    <span class="n">send_asset_data_to_cloud</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">payload_timestamp</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Retrieve data</span>
    <span class="n">data_from_cloud</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_asset_data_from_cloud</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">asset_name</span><span class="p">,</span> <span class="n">payload_timestamp</span><span class="p">))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data from Cloud.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>

<span class="n">data_from_cloud</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>------------------
Asset: CO2_ppm
------------------
Payload: [1250, 950, 400, 950, 1250, 950, 400]
Payload label: [&#39;Bad&#39;, &#39;Moderate&#39;, &#39;Good&#39;, &#39;Moderate&#39;, &#39;Bad&#39;, &#39;Moderate&#39;, &#39;Good&#39;]
Time: 2021-08-27T09:13:54.643491 - Value: 1250 ,- Label: [&#39;Bad&#39;]
Time: 2021-08-27T09:14:05.032053 - Value: 950 ,- Label: [&#39;Moderate&#39;]
Time: 2021-08-27T09:14:15.410910 - Value: 400 ,- Label: [&#39;Good&#39;]
Time: 2021-08-27T09:14:25.815638 - Value: 950 ,- Label: [&#39;Moderate&#39;]
Time: 2021-08-27T09:14:36.196445 - Value: 1250 ,- Label: [&#39;Bad&#39;]
Time: 2021-08-27T09:14:46.561765 - Value: 950 ,- Label: [&#39;Moderate&#39;]
Time: 2021-08-27T09:14:56.907719 - Value: 400 ,- Label: [&#39;Good&#39;]
------------------
Data from Cloud.
------------------

[[{&#39;at&#39;: &#39;2021-08-27T09:13:54.643Z&#39;, &#39;data&#39;: 1250}],
 [{&#39;at&#39;: &#39;2021-08-27T09:14:05.032Z&#39;, &#39;data&#39;: 950}],
 [{&#39;at&#39;: &#39;2021-08-27T09:14:15.41Z&#39;, &#39;data&#39;: 400}],
 [{&#39;at&#39;: &#39;2021-08-27T09:14:25.815Z&#39;, &#39;data&#39;: 950}],
 [{&#39;at&#39;: &#39;2021-08-27T09:14:36.196Z&#39;, &#39;data&#39;: 1250}],
 [{&#39;at&#39;: &#39;2021-08-27T09:14:46.561Z&#39;, &#39;data&#39;: 950}],
 [{&#39;at&#39;: &#39;2021-08-27T09:14:56.907Z&#39;, &#39;data&#39;: 400}]]
</code></pre></div>

<p><img alt="AllThingsTalk_Pinboard_Test" src="\img\Rules\AllThingsTalk_Pinboard_Test.PNG" /></p>
<hr />
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../Retrieve_data/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Retrieve data" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Retrieve data
            </div>
          </div>
        </a>
      
      
        
        <a href="../license/" class="md-footer__link md-footer__link--next" aria-label="Next: License" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              License
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>